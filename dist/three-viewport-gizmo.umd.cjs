(function(l,n){typeof exports=="object"&&typeof module<"u"?n(exports,require("three")):typeof define=="function"&&define.amd?define(["exports","three"],n):(l=typeof globalThis<"u"?globalThis:l||self,n(l.ThreeViewportGizmo={},l.THREE))})(this,function(l,n){"use strict";var K=Object.defineProperty;var tt=(l,n,y)=>n in l?K(l,n,{enumerable:!0,configurable:!0,writable:!0,value:y}):l[n]=y;var p=(l,n,y)=>(tt(l,typeof n!="symbol"?n+"":n,y),y);const y=(t,i,e)=>{const a=document.createElement("div"),r=a.style,{top:h,left:s,right:c,bottom:u}=e;r.height=`${i}px`,r.width=`${i}px`,r.borderRadius="100%",r.position="absolute",r.background="#fff3",r.opacity="0",r.zIndex="10000";const[o,d]=t.split("-");return r.transform="",r.margin=`${h}px ${c}px ${u}px ${s}px`,r.left=d==="left"?"0":d==="center"?"50%":"",r.right=d==="right"?"0":"",r.transform+=d==="center"?"translateX(-50%)":"",r.top=o==="top"?"0":o==="bottom"?"":"50%",r.bottom=o==="bottom"?"0":"",r.transform+=o==="center"?"translateY(-50%)":"",a},L=["x","y","z","nx","ny","nz"],R={container:document.body,placement:"top-right",size:128,lineWidth:3,offset:{top:0,left:0,right:0,bottom:0},x:{text:"X",colors:{main:"#ff3653"}},y:{text:"Y",colors:{main:"#8adb00"}},z:{text:"Z",colors:{main:"#2c8fff"}},nx:{drawLine:!1,colors:{main:"#ff3653"}},ny:{drawLine:!1,colors:{main:"#8adb00"}},nz:{drawLine:!1,colors:{main:"#2c8fff"}},backgroundSphere:{enabled:!0,color:16777215,opacity:.2}},_=new n.Color,q=t=>{const i=[],e=[];L.forEach((r,h)=>{const s=t[r];if(s.drawLine===!1)return;const c=h<3?1:-1,u=h<3?.9:1.025;i.push(r.includes("x")?u*c:0,r.includes("y")?u*c:0,r.includes("z")?u*c:0,0,0,0);const o=s.colors.main,[d,x]=Array.isArray(o)?o:[o,o];e.push(..._.set(x).toArray(),..._.set(d).toArray())});const a=new n.BufferGeometry;return a.setAttribute("position",new n.BufferAttribute(new Float32Array(i),3)),a.setAttribute("color",new n.BufferAttribute(new Float32Array(e),3)),new n.LineSegments(a,new n.LineBasicMaterial({linewidth:t.lineWidth??3,vertexColors:!0}))},F=t=>{const i=typeof t=="string"?document.querySelector(t):t;if(!i)throw Error("Invalid DOM element");return i};function V(t){const i=new n.SphereGeometry(1.6,64,64);return new n.Mesh(i,new n.MeshBasicMaterial({color:t,side:n.BackSide,transparent:!0,opacity:0,depthTest:!1}))}function j(t,i,e,a,r,h){const s=document.createElement("canvas");s.width=128,s.height=64;const c=s.getContext("2d");if(z(c,32,t,h),z(c,96,a||"#FFF",h),i!=null){const o=i.length>1,d=o?46:50;c.font=`bold ${o?40:48}px helvetica`,c.textAlign="center",c.fillStyle=e||"#000",c.fillText(i.toUpperCase(),32,d),c.fillStyle=r||e||"#000",c.fillText(i.toUpperCase(),96,d)}const u=new n.CanvasTexture(s);return u.colorSpace=n.SRGBColorSpace,u.wrapS=u.wrapT=n.RepeatWrapping,u.repeat.x=.5,new n.SpriteMaterial({map:u,toneMapped:!1,transparent:!0})}function z(t,i,e,a){const r=a?28:32;a&&(t.globalAlpha=.2),t.beginPath(),t.arc(i,32,r,0,2*Math.PI),t.closePath(),t.fillStyle=e,t.fill(),a&&(t.globalAlpha=1,t.strokeStyle=e,t.lineWidth=4,t.stroke())}function B(t){return L.map((i,e)=>{const{text:a,colors:r,border:h}=t[i],s=e<3,c=s?i:i[1],{text:u,main:o,hover:d,hoverText:x}=r,J=Array.isArray(o)?o[1]:o,D=h&&a,w=new n.Sprite(j(_.set(J).getStyle(),a,u&&_.set(u).getStyle()||null,d&&_.set(d).getStyle()||null,x&&_.set(x).getStyle()||null,h));return w.userData.type=i,w.userData.forceScale=D,w.scale.setScalar(D||s?.6:.4),w.position[c]=s?1.2:-1.2,w.renderOrder=1,w})}const b=new n.Object3D;function Q(t,i,e){m.multiplyScalar(i.value).add(e),b.position.copy(e),b.lookAt(t.position),g.copy(b.quaternion),b.lookAt(m),E.copy(b.quaternion)}function P(t,i,e){i.value=t.position.distanceTo(e)}function G(t,i,e,a){switch(e){case"x":m.set(1,0,0),f.setFromEuler(new n.Euler(0,Math.PI*.5,0));break;case"y":m.set(0,1,0),f.setFromEuler(new n.Euler(-Math.PI*.5,0,0));break;case"z":m.set(0,0,1),f.setFromEuler(new n.Euler);break;case"nx":m.set(-1,0,0),f.setFromEuler(new n.Euler(0,-Math.PI*.5,0));break;case"ny":m.set(0,-1,0),f.setFromEuler(new n.Euler(Math.PI*.5,0,0));break;case"nz":m.set(0,0,-1),f.setFromEuler(new n.Euler(0,Math.PI,0));break;default:console.error("ViewHelper: Invalid axis.")}P(t,a,i),Q(t,a,i)}const S=new n.Vector3;function X(t,i){S.set(0,0,1),S.applyQuaternion(i.quaternion),S.x>=0?(t[0].material.opacity=1,t[3].material.opacity=.5):(t[0].material.opacity=.5,t[3].material.opacity=1),S.y>=0?(t[1].material.opacity=1,t[4].material.opacity=.5):(t[1].material.opacity=.5,t[4].material.opacity=1),S.z>=0?(t[2].material.opacity=1,t[5].material.opacity=.5):(t[2].material.opacity=.5,t[5].material.opacity=1)}function $(t,i,e=10){return Math.abs(t.clientX-i.x)<e&&Math.abs(t.clientY-i.y)<e}function M(t){let i=t.length;for(;i--;)t[i].scale.setScalar(i<3||t[i].userData.forceScale?.6:.4),t[i].material.map.offset.x=1}const C=new n.Vector2;function H(t,i,e){C.x=(t.clientX-i.left)/i.width*2-1,C.y=-((t.clientY-i.top)/i.height)*2+1,A.setFromCamera(C,e)}function I(t,i,e,a){H(t,i,e);const r=A.intersectObjects(a);return r.length?r[0].object:null}function W(t,i,e){return Math.min(Math.max(t,i),e)}const m=new n.Vector3,f=new n.Quaternion,g=new n.Quaternion,E=new n.Quaternion,A=new n.Raycaster,Y=new n.Clock,U=new n.Euler,Z=2*Math.PI,O=new n.Vector2,k=new n.Vector2,v={value:0};let T=0;class N extends n.Object3D{constructor(e,a,r){super();p(this,"_backgroundSphere");p(this,"_bgSphereOpacity",.2);p(this,"_spritePoints");p(this,"_container");p(this,"_domRect");p(this,"_viewport",new n.Vector4);p(this,"_renderer");p(this,"_orthoCamera",new n.OrthographicCamera(-1.8,1.8,1.8,-1.8,0,4));p(this,"_domElement");p(this,"enabled",!0);p(this,"camera");p(this,"animated",!0);p(this,"animating",!1);p(this,"target",new n.Vector3);p(this,"dragging",!1);p(this,"size");p(this,"speed",1);this._renderer=a,this._container=a.domElement,this.camera=e,this._orthoCamera.position.set(0,0,2),r=Object.assign(R,r||{});const{container:h,placement:s,size:c,offset:u,backgroundSphere:o}=r;this.size=c;const d=q(r);this._spritePoints=B(r),this.add(d,...this._spritePoints),o.enabled&&(this._backgroundSphere=V(o.color),this._bgSphereOpacity=o.opacity??.2,this.add(this._backgroundSphere)),this._domElement=y(s,c,u),F(h).appendChild(this._domElement),this._domRect=this._domElement.getBoundingClientRect(),this._startListening(),this.update()}render(){const e=Y.getDelta();this.animating&&this._animate(e);const a=this._domRect.left,r=T-this._domRect.bottom,h=this._renderer.autoClear;this._renderer.autoClear=!1,this._renderer.setViewport(a,r,this.size,this.size),this._renderer.render(this,this._orthoCamera),this._renderer.setViewport(this._viewport),this._renderer.autoClear=h}update(){this._domRect=this._domElement.getBoundingClientRect(),T=this._container.offsetHeight,P(this.camera,v,this.target),this._renderer.getViewport(this._viewport),this._updateOrientation()}dispose(){this.children.forEach(e=>{var a;e.material.dispose(),e.isMesh||e.isLineSegments?e.geometry.dispose():(a=e.material.map)==null||a.dispose()}),this._domElement.remove()}_updateOrientation(e=!0){e&&(this.quaternion.copy(this.camera.quaternion).invert(),this.updateMatrixWorld()),X(this._spritePoints,this.camera)}_animate(e){if(!this.animated){this.camera.quaternion.copy(f),this.animating=!1,this.dispatchEvent({type:"change"}),this.dispatchEvent({type:"end"});return}const a=e*Z*this.speed;g.rotateTowards(E,a),this.camera.position.set(0,0,1).applyQuaternion(g).multiplyScalar(v.value).add(this.target),this.camera.quaternion.rotateTowards(f,a),this._updateOrientation(),this.dispatchEvent({type:"change"}),g.angleTo(E)===0&&(this.animating=!1,this.dispatchEvent({type:"end"}))}_setOrientation(e){G(this.camera,this.target,e,v),this.animating=!0,this.dispatchEvent({type:"start"})}_startListening(){this._domElement.onpointerdown=e=>this._onPointerDown(e),this._domElement.onpointermove=e=>this._onPointerMove(e),this._domElement.onpointerleave=()=>this._onPointerLeave()}_onPointerDown(e){if(!this.enabled)return;const a=s=>{!this.dragging&&$(s,O)||(this.dragging||(M(this._spritePoints),this.dragging=!0),k.set(s.clientX,s.clientY).sub(O).multiplyScalar(1/this._domRect.width*Math.PI),this.rotation.x=W(h.x+k.y,Math.PI/-2+.001,Math.PI/2-.001),this.rotation.y=h.y+k.x,this.updateMatrixWorld(),g.copy(this.quaternion).invert(),this.camera.position.set(0,0,1).applyQuaternion(g).multiplyScalar(v.value).add(this.target),this.camera.rotation.setFromQuaternion(g),this._updateOrientation(!1),this.dispatchEvent({type:"change"}))},r=()=>{if(document.removeEventListener("pointermove",a,!1),document.removeEventListener("pointerup",r,!1),!this.dragging)return this._handleClick(e);this.dragging=!1,this.dispatchEvent({type:"end"})};if(this.animating===!0)return;e.preventDefault(),O.set(e.clientX,e.clientY);const h=U.copy(this.rotation);P(this.camera,v,this.target),document.addEventListener("pointermove",a,!1),document.addEventListener("pointerup",r,!1),this.dispatchEvent({type:"start"})}_onPointerMove(e){!this.enabled||this.dragging||(this._backgroundSphere&&(this._backgroundSphere.material.opacity=this._bgSphereOpacity),this._handleHover(e))}_onPointerLeave(){!this.enabled||this.dragging||(this._backgroundSphere&&(this._backgroundSphere.material.opacity=0),M(this._spritePoints),this._domElement.style.cursor="")}_handleClick(e){const a=I(e,this._domRect,this._orthoCamera,this._spritePoints);a&&(this._setOrientation(a.userData.type),this.dispatchEvent({type:"change"}))}_handleHover(e){const a=I(e,this._domRect,this._orthoCamera,this._spritePoints);M(this._spritePoints),a?(a.material.map.offset.x=.5,a.scale.multiplyScalar(1.2),this._domElement.style.cursor="pointer"):this._domElement.style.cursor=""}}l.ViewportGizmo=N,l.q1=g,l.q2=E,l.raycaster=A,l.targetPosition=m,l.targetQuaternion=f,Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=three-viewport-gizmo.umd.cjs.map
